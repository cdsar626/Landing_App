---

---

<div class="lang-switcher">
  <button id="lang-btn-es" class="lang-btn" title="EspaÃ±ol">
    <span class="flag">ðŸ‡ªðŸ‡¸</span>
  </button>
  <button id="lang-btn-en" class="lang-btn active" title="English">
    <span class="flag">ðŸ‡ºðŸ‡¸</span>
  </button>
</div>

<style>
  .lang-switcher {
    position: fixed;
    top: 1.5rem;
    right: 1.5rem;
    display: flex;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 0.4rem;
    border-radius: 99px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    z-index: 1000;
  }

  .lang-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s;
    font-size: 1.2rem;
    opacity: 0.5;
    filter: grayscale(100%);
  }

  .lang-btn:hover {
    opacity: 1;
    background: rgba(255, 255, 255, 0.1);
  }

  .lang-btn.active {
    opacity: 1;
    filter: grayscale(0%);
    background: rgba(255, 255, 255, 0.15);
  }

  @media (max-width: 600px) {
    .lang-switcher {
      top: 1rem;
      right: 1rem;
    }
  }
</style>

<script>
  // @ts-nocheck
  import { translations } from "../utils/i18n.js";

  const btnEs = document.getElementById("lang-btn-es");
  const btnEn = document.getElementById("lang-btn-en");

  function updateLanguage(lang) {
    if (!btnEs || !btnEn) return;

    // Validate lang, fallback to 'en' if invalid
    const safeLang = lang === "es" || lang === "en" ? lang : "en";

    // Update buttons
    if (safeLang === "es") {
      btnEs.classList.add("active");
      btnEn.classList.remove("active");
    } else {
      btnEn.classList.add("active");
      btnEs.classList.remove("active");
    }

    // Save preference
    localStorage.setItem("preferred-lang", safeLang);
    document.documentElement.lang = safeLang;

    // Get translations for the selected language
    const currentTranslations = translations[safeLang];

    // Update all translatable elements
    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      if (key && currentTranslations && currentTranslations[key]) {
        // Use innerHTML because some translations have <span> or <b>
        el.innerHTML = currentTranslations[key];
      }
    });

    // Update placeholders
    document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
      const key = el.getAttribute("data-i18n-placeholder");
      if (key && currentTranslations && currentTranslations[key]) {
        el.setAttribute("placeholder", currentTranslations[key]);
      }
    });

    // Dispatch a custom event in case other components need to listen
    window.dispatchEvent(
      new CustomEvent("languageChanged", { detail: { lang: safeLang } }),
    );
  }

  if (btnEs && btnEn) {
    btnEs.addEventListener("click", () => updateLanguage("es"));
    btnEn.addEventListener("click", () => updateLanguage("en"));

    // Init from localStorage or detect Spanish browser lang, otherwise default to English
    // Logic:
    // 1. Check local storage (returning user preference)
    // 2. If no storage, check navigator.language.
    //    - If starts with 'es', use 'es'.
    //    - If anything else (en, fr, de...), use 'en'.
    // 3. Default fallback is 'en'.

    const browserLang = navigator.language.startsWith("es") ? "es" : "en";
    const savedLang = localStorage.getItem("preferred-lang");
    const initialLang = savedLang || browserLang;

    updateLanguage(initialLang);
  }
</script>
